<Window x:Class="ImageDescriber.Full.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ImageDescriber.Full"
        xmlns:converters="clr-namespace:ImageDescriber.Full.Converters"
        mc:Ignorable="d"
        Title="ImageDescriber - Professional Edition" Height="700" Width="1000"
        MinHeight="600" MinWidth="800">

    <Window.Resources>
        <!-- Converters -->
        <converters:FilePathToImageSourceConverter x:Key="FilePathToImageSourceConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Image List Item Template -->
        <DataTemplate x:Key="ImageItemTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding FileName}" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" Text="{Binding DescriptionCount, StringFormat='({0})'}" 
                           Foreground="Gray" Margin="5,0,0,0" VerticalAlignment="Center"/>
            </Grid>
        </DataTemplate>
        
        <!-- Description List Item Template -->
        <DataTemplate x:Key="DescriptionItemTemplate">
            <StackPanel Margin="2">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="{Binding Model}" FontWeight="Bold" FontSize="10"/>
                    <TextBlock Grid.Column="1" Text="{Binding Provider}" FontSize="9" Foreground="DarkBlue"/>
                </Grid>
                <TextBlock Text="{Binding Text}" TextWrapping="Wrap" MaxHeight="60" TextTrimming="CharacterEllipsis"/>
                <TextBlock Text="{Binding Created}" FontSize="9" Foreground="Gray"/>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar (IsTabStop="False" to fix accessibility issue) -->
        <Menu Grid.Row="0" IsTabStop="False">
            <MenuItem Header="_File">
                <MenuItem Header="_New Workspace" Command="{Binding NewWorkspaceCommand}"/>
                <MenuItem Header="_Open Workspace..." Command="{Binding OpenWorkspaceCommand}"/>
                <MenuItem Header="_Save Workspace" Command="{Binding SaveWorkspaceCommand}"/>
                <MenuItem Header="Save Workspace _As..." Command="{Binding SaveWorkspaceAsCommand}"/>
                <Separator/>
                <MenuItem Header="Add _Directory..." Command="{Binding AddDirectoryCommand}"/>
                <MenuItem Header="Add _Files..." Command="{Binding AddFilesCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Edit Description" Command="{Binding EditDescriptionCommand}"/>
                <MenuItem Header="_Delete Description" Command="{Binding DeleteDescriptionCommand}"/>
                <MenuItem Header="_Copy Description" Command="{Binding CopyDescriptionCommand}"/>
                <Separator/>
                <MenuItem Header="_Process Selected Image" Command="{Binding ProcessSelectedCommand}"/>
                <MenuItem Header="_Process Batch" Command="{Binding ProcessBatchCommand}"/>
                <MenuItem Header="_Stop Processing" Command="{Binding StopProcessingCommand}"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_AI Settings..." Command="{Binding ShowAISettingsCommand}"/>
                <MenuItem Header="_Refresh Models" Command="{Binding RefreshModelsCommand}"/>
                <MenuItem Header="_Extract Video Frames..." Command="{Binding ExtractVideoFramesCommand}"/>
                <MenuItem Header="_Convert HEIC..." Command="{Binding ConvertHeicCommand}"/>
                <MenuItem Header="_Export Descriptions..." Command="{Binding ExportDescriptionsCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Command="{Binding AboutCommand}"/>
                <MenuItem Header="User _Guide" Command="{Binding ShowUserGuideCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Main Content Area - Two Panel Layout like Python Qt6 app -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400" MinWidth="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*" MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Image List -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Images Header -->
                <Border Grid.Row="0" Background="LightGray" Padding="5">
                    <TextBlock Text="Images:" FontWeight="Bold"/>
                </Border>
                
                <!-- Image List -->
                <ListBox Grid.Row="1" 
                         Name="ImageListBox"
                         ItemsSource="{Binding WorkspaceItems}"
                         SelectedItem="{Binding SelectedImageItem}"
                         ItemTemplate="{StaticResource ImageItemTemplate}"
                         AutomationProperties.Name="Image List"
                         AutomationProperties.HelpText="List of images in the workspace. Use arrow keys to navigate, then Tab to move to descriptions."/>
                
                <!-- Batch Info -->
                <TextBlock Grid.Row="2" 
                          Text="{Binding BatchInfo}" 
                          Padding="5" 
                          Background="LightBlue" 
                          FontSize="10"/>
            </Grid>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" 
                         Background="LightGray" ResizeBehavior="PreviousAndNext"/>

            <!-- Right Panel - Descriptions -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200" MinHeight="150"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Descriptions Header -->
                <Border Grid.Row="0" Background="LightGray" Padding="5">
                    <TextBlock Text="Descriptions:" FontWeight="Bold"/>
                </Border>
                
                <!-- Description List -->
                <ListBox Grid.Row="1"
                         Name="DescriptionListBox" 
                         ItemsSource="{Binding SelectedImageItem.Descriptions}"
                         SelectedItem="{Binding SelectedDescription}"
                         ItemTemplate="{StaticResource DescriptionItemTemplate}"
                         AutomationProperties.Name="Description List"
                         AutomationProperties.HelpText="List of descriptions for the selected image. Use arrow keys to navigate and view different descriptions."/>

                <!-- Description Text Header -->
                <Border Grid.Row="2" Background="LightGray" Padding="5">
                    <TextBlock Text="Description Text:" FontWeight="Bold"/>
                </Border>
                
                <!-- Description Text Display -->
                <TextBox Grid.Row="3" 
                         Text="{Binding SelectedDescription.Text, Mode=OneWay}"
                         IsReadOnly="True" 
                         TextWrapping="Wrap" 
                         VerticalScrollBarVisibility="Auto"
                         AutomationProperties.Name="Description Text"
                         AutomationProperties.HelpText="Full text of the selected description. Use arrow keys to navigate through the text."
                         Margin="2"/>
            </Grid>
        </Grid>

        <!-- AI Provider Settings -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <Label Grid.Column="0" Content="Provider:" VerticalAlignment="Center" Margin="5,2"/>
            <ComboBox Grid.Column="1" 
                      ItemsSource="{Binding AvailableProviders}"
                      SelectedItem="{Binding SelectedProvider}"
                      DisplayMemberPath="DisplayName"
                      Margin="2"
                      AutomationProperties.Name="AI Provider"
                      AutomationProperties.HelpText="Select AI provider for image processing"/>
            
            <Label Grid.Column="2" Content="Model:" VerticalAlignment="Center" Margin="5,2"/>
            <ComboBox Grid.Column="3" 
                      ItemsSource="{Binding AvailableModels}"
                      SelectedItem="{Binding SelectedModel}"
                      Margin="2"
                      AutomationProperties.Name="AI Model"
                      AutomationProperties.HelpText="Select AI model for image processing"/>
            
            <Button Grid.Column="4" 
                    Content="Process" 
                    Command="{Binding ProcessSelectedCommand}"
                    Margin="5,2"
                    AutomationProperties.Name="Process Image"
                    AutomationProperties.HelpText="Process the selected image with AI"/>
        </Grid>

        <!-- Status Bar and Progress -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>
            
            <!-- Status Message -->
            <TextBlock Grid.Column="0" 
                       Text="{Binding StatusMessage}" 
                       VerticalAlignment="Center" 
                       Margin="5,2"
                       AutomationProperties.Name="Status Message"/>
            
            <!-- Progress Bar -->
            <StackPanel Grid.Column="1" Orientation="Vertical" Margin="2">
                <TextBlock Text="{Binding ProgressText}" 
                           HorizontalAlignment="Center" 
                           FontSize="10"
                           AutomationProperties.Name="Progress Text"/>
                <ProgressBar Value="{Binding ProgressValue}" 
                            Maximum="100" 
                            Height="15"
                            AutomationProperties.Name="Progress Bar"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>