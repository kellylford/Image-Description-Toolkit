# Comprehensive Test Suite - Image Description Toolkit

## Overview
The `comprehensive_test.py` script provides thorough testing of the entire Image Description Toolkit to ensure functionality and prevent regressions.

## Test Categories

### 1. Dependencies
- Tests that all required Python packages can be imported
- Validates core dependencies (PIL, requests, pathlib)
- Optional dependencies tested in full mode (ollama, cv2, numpy)

### 2. File Consistency
- Verifies all scripts exist and are accessible
- Checks for all configuration files
- Validates documentation files (README files)

### 3. Workflow Utilities
- Tests WorkflowConfig creation and functionality
- Validates output directory generation
- Tests WorkflowLogger functionality
- Verifies FileDiscovery patterns

### 4. Script Help
- Tests that all scripts provide help output
- Validates command-line argument parsing
- Ensures scripts can be executed without errors

### 5. Individual Script Testing
- **image_describer.py**: Basic functionality and AI model integration
- **ConvertImage.py**: Directory processing and HEIC conversion handling
- **video_frame_extractor.py**: Configuration loading and OpenCV integration
- **descriptions_to_html.py**: Text file parsing and HTML generation

### 6. Workflow System
- Tests workflow orchestrator functionality
- Validates dry-run mode
- Checks configuration loading and integration

## Usage

### Run All Tests
```bash
python comprehensive_test.py
```

### Quick Mode (Skip AI-dependent tests)
```bash
python comprehensive_test.py --quick
```

### Test Specific Components
```bash
# Test individual scripts only
python comprehensive_test.py --individual

# Test workflow system only
python comprehensive_test.py --workflow
```

### Verbose Output
```bash
python comprehensive_test.py --verbose
```

### Clean Up After Testing
```bash
python comprehensive_test.py --cleanup
```

## Test Files

The test suite uses files in the `test_files/` directory:

### Generated Test Images
- `test_files/images/` - Contains programmatically generated test images
- Various formats: JPG, PNG with different sizes and colors
- Generated by `generate_test_images.py`

### Test Descriptions
- `test_files/test_descriptions.txt` - Sample descriptions file for HTML testing
- Follows the format expected by `descriptions_to_html.py`

### Test Output
- `test_output/` - Directory for test outputs (created during testing)
- Contains results from individual script tests
- Automatically cleaned up if `--cleanup` flag is used

## Test Modes

### Quick Mode (`--quick`)
- Skips AI model tests (ollama-dependent)
- Skips video processing tests (OpenCV-dependent)
- Tests core functionality and script interfaces
- Ideal for CI/CD or environments without full dependencies

### Full Mode (default)
- Tests all functionality including AI models
- Requires complete dependency installation
- Tests actual image processing and description generation
- Comprehensive end-to-end validation

## Expected Results

### Quick Mode
All tests should pass even without Ollama or OpenCV installed:
- ✅ Dependencies (core only)
- ✅ File consistency (all files present)
- ✅ Workflow utilities
- ✅ Script help (all scripts show usage)
- ✅ Basic script functionality
- ✅ Workflow system (dry-run mode)

### Full Mode
Requires complete installation (`pip install -r requirements.txt` + Ollama):
- ✅ All quick mode tests
- ✅ AI model integration
- ✅ Video processing functionality
- ✅ End-to-end workflow execution

## Error Handling

The test suite provides detailed error reporting:
- **Clear error messages** for each failed test
- **Context information** about what was being tested
- **Suggestions** for common issues (missing dependencies, etc.)
- **Summary report** showing overall pass/fail status

## Integration with Development

### Pre-commit Testing
```bash
# Quick validation before commits
python comprehensive_test.py --quick
```

### Full Validation
```bash
# Complete testing before releases
python comprehensive_test.py
```

### Continuous Integration
The test suite is designed to work in CI environments:
- Exit codes: 0 for success, 1 for failure
- Machine-readable output
- Configurable test levels
- Minimal external dependencies in quick mode

## Troubleshooting

### Common Issues

**"Module not found" errors:**
```bash
pip install -r requirements.txt
```

**Ollama connection issues:**
- Ensure Ollama is installed and running
- Test: `python debug_ollama.py`

**OpenCV import issues:**
- Quick mode automatically skips OpenCV tests
- For full mode: `pip install opencv-python`

**Test file issues:**
```bash
# Regenerate test images
python generate_test_images.py
```

### Debug Mode
```bash
# Get detailed output for debugging
python comprehensive_test.py --verbose
```

## Extending Tests

To add new tests:

1. Add test methods to the `TestRunner` class
2. Follow the pattern: `def test_component_name(self) -> bool`
3. Use `self.add_result()` to record test outcomes
4. Handle both quick and full modes appropriately
5. Update documentation

Example test method:
```python
def test_new_component(self) -> bool:
    """Test new component functionality"""
    self.log("Testing new component...")
    
    try:
        # Test logic here
        self.add_result("New Component", "Basic functionality", True)
        return True
    except Exception as e:
        self.add_result("New Component", "Basic functionality", False, str(e))
        return False
```

The comprehensive test suite ensures the Image Description Toolkit maintains high quality and reliability across all components.
