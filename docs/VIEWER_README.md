# Image Description Viewer

A Qt6-based desktop application for browsing and viewing image descriptions generated by the Image Description Toolkit workflow.

## Features

- **Accessible Navigation**: Browse image descriptions with full screen reader support
- **Image Preview**: View full-size images alongside their descriptions
- **Clipboard Integration**: Copy descriptions, image file paths, or images to clipboard
- **AI Redescription**: Generate new descriptions using different models and prompt styles
- **Keyboard Navigation**: Full keyboard and tab navigation support

## Installation

The viewer requires PyQt6, which can be installed with:

```bash
pip install PyQt6
```

Or if using the project's virtual environment, PyQt6 is already included in the requirements.

## Usage

### Starting the Viewer

Run the viewer application:

```bash
python viewer/image_viewer.py
```

### Loading a Workflow Output

1. Activate the **"Change Directory"** button
2. Navigate to and select a completed workflow output directory (e.g., `workflow_moondream_narrative_20250901_223412`)
3. The viewer will automatically parse the HTML report and load all images and descriptions

### Navigation

- **List Navigation**: Use arrow keys or mouse to select images in the left panel
- **Tab Navigation**: Press Tab to cycle through all focusable elements including the image preview
- **Keyboard Shortcuts**: Standard Qt keyboard navigation applies

### Accessibility Features

- **Screen Reader Support**: Each list item contains the full image description as accessible text
- **Visual Truncation**: List items show only filenames visually to keep the interface clean
- **Tooltips**: Hover over list items to see the full description
- **Tab Focus**: All elements including the image preview can receive keyboard focus

### Clipboard Operations

- **Copy Description**: Copies the full text description to clipboard
- **Copy Image Path**: Copies the full file path of the selected image to clipboard
- **Copy Image**: Copies the actual image data to clipboard for pasting into other applications

### AI Redescription

- **Redescribe Button**: Generate a new description for the selected image
- **Model Selection**: Choose from available Ollama models (moondream, llava:7b, llama3.2-vision:11b, etc.)
- **Prompt Styles**: Select from different description styles (detailed, concise, narrative, artistic, technical, colorful)
- **Live Updates**: New descriptions immediately update the interface
- **Background Processing**: Redescription runs in background without blocking the UI

**Requirements for Redescription:**
- Ollama must be installed and running
- At least one vision model must be available (e.g., `ollama pull moondream`)
- The `scripts/` directory must be accessible relative to the viewer

## Interface Layout

The viewer uses a split-panel layout:

- **Left Panel**: List of images (max width 400px)
- **Right Panel**: 
  - Image preview area (scalable, maintains aspect ratio)
  - Full description text box (read-only)
  - Action buttons: Copy Description, Copy Image Path, Copy Image, Redescribe

## Supported Formats

The viewer works with workflow output directories that contain:
- `html_reports/image_descriptions.html` - Main data source
- Images in various subdirectories (converted_images, extracted_frames, etc.)

## Technical Notes

- Built with PyQt6 for modern Qt support
- Parses HTML reports using regex patterns
- Handles HTML entity decoding automatically
- Scales images while preserving aspect ratios
- Uses Qt's accessibility framework for screen reader support

## Troubleshooting

**App won't start**: Ensure PyQt6 is installed and you're using Python 3.8+

**No images/descriptions load**: Verify the selected directory contains `html_reports/image_descriptions.html`

**Clipboard not working**: Some clipboard operations may require the app to have focus in your window manager

**Images not displaying**: Check that image files exist in the expected subdirectories and aren't corrupted

**Redescribe button disabled/not working**: 
- Ensure Ollama is installed and running (`ollama serve`)
- Verify you have vision models installed (`ollama list`)
- Check that the scripts directory is accessible from the viewer location

**Redescribe fails with "Model not available"**: Install the desired model with `ollama pull <model-name>`
