# Image Description Viewer

A standalone GUI application for browsing and managing image descriptions generated by the Image Description Toolkit workflows.

## Features

### Two Viewing Modes

1. **HTML Mode** - View completed workflows with full HTML reports
   - Browse finalized workflow results
   - Navigate through image descriptions
   - Copy descriptions to clipboard
   - Redescribe images using Ollama (if available)

2. **Live Mode** - Monitor workflows in progress with real-time updates
   - Watch descriptions appear as they're generated
   - Auto-refresh to show new content
   - See progress indicators
   - Seamlessly transition to HTML mode when workflow completes

### Command-Line Interface

The viewer supports command-line arguments for flexible launching:

```bash
# Launch viewer with empty window (browse for directory manually)
viewer.exe

# Open specific workflow output directory
viewer.exe C:\path\to\workflow_output

# Launch directly to directory selection dialog
viewer.exe --open

# Show help and usage information
viewer.exe --help
```

### Keyboard Shortcuts

- **Up/Down Arrow** - Navigate between images
- **Ctrl+C** - Copy current description to clipboard
- **Ctrl+R** - Redescribe current image (requires Ollama)

## Building the Viewer

### Prerequisites

- Python 3.10+
- PyQt6
- PyInstaller

### Build Command

```bash
cd viewer
build_viewer.bat
```

The build script will:
1. Detect your system architecture (AMD64 or ARM64)
2. Create a standalone executable in `dist/viewer/`
3. Bundle all necessary dependencies
4. Include the scripts directory for redescription functionality

### Output

- **Executable**: `dist/viewer/viewer_<arch>.exe`
  - Example: `viewer_amd64.exe` on 64-bit Windows
- **Architecture-specific**: Automatically detects and builds for your system

## Integration with IDT

The viewer can be launched from the main IDT CLI:

```bash
# Launch viewer from IDT
idt viewer

# The launcher will:
# - Auto-detect your architecture
# - Search for viewer executable in multiple locations
# - Launch as a detached process (viewer runs independently)
```

See `VIEWER_LAUNCHER_README.md` in the root directory for launcher implementation details.

## Usage Examples

### Viewing a Completed Workflow

```bash
# Option 1: Launch with directory
viewer.exe "C:\workflows\wf_claude_20251011_112851"

# Option 2: Launch then browse
viewer.exe --open
```

### Monitoring a Running Workflow

1. Start a workflow in one terminal:
   ```bash
   idt workflow images/ --provider claude --model claude-3-haiku-20240307
   ```

2. Launch viewer in live mode:
   ```bash
   viewer.exe "path\to\output" 
   # Or use --open to browse for the directory
   ```

3. Enable "Live Mode" checkbox to see real-time updates

### Redescribing Images

If you have Ollama installed locally:

1. Select an image in the viewer
2. Press **Ctrl+R** or click "Redescribe with Ollama"
3. Choose a model from the dropdown
4. Updated description appears with a highlight indicator

## Directory Structure Expected

The viewer expects workflow output directories with this structure:

```
workflow_output/
├── descriptions/
│   └── image_descriptions.txt    # Live descriptions (for Live Mode)
├── html_reports/
│   └── image_descriptions.html   # Finalized HTML (for HTML Mode)
└── <original_structure>/
    └── *.jpg, *.png, etc.        # Original images
```

## Technical Details

### Live Mode Implementation

- Uses QFileSystemWatcher to monitor description file changes
- Auto-refresh timer (configurable interval)
- Preserves scroll position and selection during updates
- Progress tracking shows current/total images processed

### Redescription Feature

- Requires Ollama running locally
- Fetches available models dynamically
- Updates description in-place
- Marks updated descriptions with visual indicator
- Original HTML file remains unchanged

### Accessibility

- Full keyboard navigation support
- Screen reader friendly labels
- Accessible descriptions for all UI elements
- Focus management for seamless navigation

## Troubleshooting

### Viewer won't launch

- Check that viewer executable exists in expected location
- Verify architecture matches your system (AMD64 vs ARM64)
- Try running from command line to see error messages

### Directory not loading

- Ensure directory contains either:
  - `html_reports/image_descriptions.html` (HTML Mode)
  - `descriptions/image_descriptions.txt` (Live Mode)
- Check that paths don't contain special characters
- Use absolute paths when specifying directory

### Redescription not working

- Ensure Ollama is installed and running
- Test with: `ollama list` in terminal
- Check that at least one vision model is available
- Common vision models: llava, moondream, bakllava

### Live Mode not updating

- Verify the workflow is still running
- Check "Live Mode" checkbox is enabled
- Try manual refresh button
- Ensure description file exists and is being written to

## Future Enhancements

- [ ] Support for multiple workflow directories in tabs
- [ ] Export selected descriptions to various formats
- [ ] Batch redescription with progress tracking
- [ ] Image comparison view (original vs thumbnails)
- [ ] Description editing and saving
- [ ] Custom model configuration for redescription
- [ ] Filter/search functionality for large workflows

## License

Part of the Image Description Toolkit - See LICENSE in root directory
